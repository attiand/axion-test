plugins {
    id 'base'
    id 'pl.allegro.tech.build.axion-release' version '1.13.14'
}

import org.eclipse.jgit.api.Git
import org.eclipse.jgit.lib.Repository

scmVersion {
    branchVersionCreator = [
        'rel_.*': 'simple',
        'patch_.*': 'simple',
        '.*': 'versionWithBranch'
    ]
    useHighestVersion = true
    ignoreUncommittedChanges = false
    tag {
        prefix = ''
    }

    hooks {
        pre {context -> databaseUpgrade(context.previousVersion, context.currentVersion)}
    }
}


String databaseUpgrade(def previousVersion, def releaseVersion) {
    Git git = Git.open(file('.'))
    Repository repository = git.getRepository()
    
    println repository.getTags()

    println "----- ${previousVersion} ${releaseVersion}"
}